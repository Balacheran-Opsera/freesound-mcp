FROM freesound:2020-02

RUN apt-get update \
    && apt-get install -y --no-install-recommends \
                       libqt4-dev \
                       libyaml-dev \
                       swig \
    && rm -rf /var/lib/apt/lists/*

# Gaia - https://github.com/MTG/gaia
RUN git clone https://github.com/MTG/gaia.git /tmp/gaia \
    && cd /tmp/gaia \
    && git checkout v2.4.5 \
    && ./waf configure --with-python-bindings \
    && ./waf \
    && ./waf install \
    && cd / && rm -r /tmp/gaia

RUN mkdir /code
RUN mkdir /code/similarity
RUN mkdir /gaia_index
WORKDIR /code/

COPY --chown=fsweb:fsweb similarity/requirements.txt /code/similarity/requirements.txt
RUN pip install --no-cache-dir -r similarity/requirements.txt

COPY --chown=fsweb:fsweb . /code
